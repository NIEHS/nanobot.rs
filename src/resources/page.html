<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ page.title }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
          <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
          <!-- TODO: Verify that all of these style elements are really needed -->
          <style>
            a:link,
            a:visited {
                text-decoration: none !important;
            }

            .bg-null {
                color: #cfcfcf;
            }

            .bg-null:before {
                content: "null";
            }
		        table {
		            border-collapse: separate;
		            border-spacing: 0px;
		        }
		        thead th {
		            position: sticky;
		            top: 0px;
		            white-space: nowrap;
		            background-color: #fff !important;
		            border-bottom-width: 1px;
		            z-index: 2;
		        }
		        tbody {
		            z-index: 1;
		        }
		        td {
		            vertical-align: middle;
		        }
		        td ul {
		            margin-left: -1rem !important;
		            margin-block: 0rem !important;
		        }

		        .long-word {
		            word-break: break-all;
		        }
		        .bg-debug {
		            background-color: #abc4ff !important;
		        }
		        a.bg-debug:hover {
		            background-color: #4d82ff !important;
		        }
		        .bg-error {
		            background-color: #ffabab !important;
		        }
		        a.bg-error:hover {
		            background-color: #ff4d4d !important;
		        }
		        .bg-info {
		            background-color: #fff8ab !important;
		        }
		        a.bg-info:hover {
		            background-color: #fff04d !important;
		        }
		        .bg-null {
		            color: #cfcfcf;
		        }
		        .bg-null:before {
		            content: "null";
		        }
		        .bg-warn {
		            background-color: #ffcdab !important;
		        }
		        a.bg-warn:hover {
		            background-color: #ff944d !important;
		        }
            .tooltip {
                position: relative;
                display: inline-block;
                border-bottom: 1px dotted black; /* If you want dots under the hoverable text */
            }

		        .tooltip-inner {
		            white-space: pre-wrap;
		        }

		        #sqlTableHorizontal, #sqlTableVertical {
		            vertical-align: inherit !important;
		        }
		        #sqlTableVertical {
		            margin: 1rem
		        }
		        #sqlTableVertical .row {
		            padding: 0.2rem 0rem 0.2rem 0rem;
		        }

		        .float {
		            position:fixed;
		            bottom:25px;
		            right:25px;
		            border-radius:50px;
		            box-shadow: 2px 2px 3px #999;
		        }
		        .float-above {
		            position:fixed;
		            bottom:80px;
		            right:25px;
		            border-radius:50px;
		            box-shadow: 2px 2px 3px #999;
		        }
		        .btn-xl-plus {
			          width: 50px;
			          height: 50px;
			          padding: 7px 7px;
			          border-radius: 35px;
			          font-size: 35px;
			          line-height: 1.33;
		        }
		        .btn-xl-pencil {
			          width: 50px;
			          height: 50px;
			          padding: 12px 12px;
			          border-radius: 35px;
			          font-size: 24px;
			          line-height: 1.33;
		        }

		        #annotations {
		            padding-left: 1em;
		            list-style-type: none !important;
		        }
		        #annotations ul, .annotations ul {
		            padding-left: 3em;
		            list-style-type: circle !important;
		        }
		        #annotations ul ul, .annotations ul ul {
		            padding-left: 2em;
		            list-style-type: none !important;
		        }
		        .hierarchy {
		            padding-left: 0em;
		            list-style-type: none !important;
		        }
		        .hierarchy ul {
		            padding-left: 1em;
		            list-style-type: none !important;
		        }
		        .hierarchy ul.multiple-children > li > ul {
		            border-left: 1px dotted #ddd;
		        }
		        .hierarchy .children {
		            border-left: none;
		            margin-left: 2em;
		            text-indent: -1em;
		        }
		        .hierarchy .children li::before {
		            content: "\2022";
		            color: #ddd;
		            display: inline-block;
		            width: 0em;
		            margin-left: -1em;
		        }
		        a {
		            text-decoration: none;
		        }

		        sup {
		            position: static !important;
		            line-height: 1 !important;
		            vertical-align: super !important;
		        }
		        sup a {
		            color: #85b6ff;
		        }
		        sup a:hover {
		            color: #0066ff;
		        }

		        span.twitter-typeahead .tt-menu {
		            cursor: pointer;
		        }
		        .dropdown-menu, span.twitter-typeahead .tt-menu {
		            position: absolute;
		            top: 100%;
		            left: 0;
		            z-index: 1000;
		            display: none;
		            float: left;
		            min-width: 160px;
		            padding: 5px 0;
		            margin: 2px 0 0;
		            font-size: 1rem;
		            color: #373a3c;
		            text-align: left;
		            list-style: none;
		            background-color: #fff;
		            background-clip: padding-box;
		            border: 1px solid rgba(0, 0, 0, 0.15);
		            border-radius: 0.25rem; }
		        span.twitter-typeahead .tt-suggestion {
		            display: block;
		            width: 100%;
		            padding: 3px 20px;
		            clear: both;
		            font-weight: normal;
		            line-height: 1.5;
		            color: #373a3c;
		            text-align: inherit;
		            white-space: nowrap;
		            background: none;
		            border: 0; }
		        span.twitter-typeahead .tt-suggestion:focus,
		        .dropdown-item:hover,
		        span.twitter-typeahead .tt-suggestion:hover {
			          color: #2b2d2f;
			          text-decoration: none;
			          background-color: #f5f5f5; }
		        span.twitter-typeahead .active.tt-suggestion,
		        span.twitter-typeahead .tt-suggestion.tt-cursor,
		        span.twitter-typeahead .active.tt-suggestion:focus,
		        span.twitter-typeahead .tt-suggestion.tt-cursor:focus,
		        span.twitter-typeahead .active.tt-suggestion:hover,
		        span.twitter-typeahead .tt-suggestion.tt-cursor:hover {
			          color: #fff;
			          text-decoration: none;
			          background-color: #0275d8;
			          outline: 0; }
		        span.twitter-typeahead .disabled.tt-suggestion,
		        span.twitter-typeahead .disabled.tt-suggestion:focus,
		        span.twitter-typeahead .disabled.tt-suggestion:hover {
			          color: #818a91; }
		        span.twitter-typeahead .disabled.tt-suggestion:focus,
		        span.twitter-typeahead .disabled.tt-suggestion:hover {
			          text-decoration: none;
			          cursor: not-allowed;
			          background-color: transparent;
			          background-image: none;
			          filter: "progid:DXImageTransform.Microsoft.gradient(enabled = false)"; }
		        span.twitter-typeahead {
		            width: 100%; }
		        .input-group span.twitter-typeahead {
			          display: block !important; }
		        .input-group span.twitter-typeahead .tt-menu {
			          top: 2.375rem !important; }
          </style>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container-fluid">
        <a class="navbar-brand">{{ page.project_name }}</a>
        <div class="collapse navbar-collapse">
          <ul class="navbar-nav">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                Tables
              </a>
              <ul class="dropdown-menu">
                {% for table, href in page.tables|items %}
                  <li><a class="dropdown-item" href="{{ href }}">{{ table }}</a></li>
                {% endfor %}
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div id="content" class="container">
      {% if page.elapsed %}<p class="float-end">{{ page.elapsed }}ms</p>{% endif %}
      {% block content %}{% endblock %}
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
            crossorigin="anonymous"></script>
            <script type="application/javascript">
              const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]')
              const popoverList = [...popoverTriggerList].map(popoverTriggerEl => new bootstrap.Popover(popoverTriggerEl))
            </script>
            <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/typeahead.js/0.11.1/typeahead.bundle.min.js">
            </script>
            <script>
              function configure_typeahead_form(node, table) {
                if (!node.id || !node.id.endsWith("-typeahead-form")) {
                  return;
                }
                var col = node.id.split("-")[0];
                var bloodhound = new Bloodhound({
                  datumTokenizer: Bloodhound.tokenizers.obj.nonword('label'),
                  queryTokenizer: Bloodhound.tokenizers.nonword,
                  sorter: function(a, b) {
                    return a.order - b.order;
                  },
                  remote: {
                    url: `/${table}?text=%QUERY&column=${col}&format=json`,
                    wildcard: '%QUERY',
                    transform : function(response) {
                      return bloodhound.sorter(response);
                    }
                  }
                });
                $(node).typeahead({
                  minLength: 0,
                  hint: false,
                  highlight: true
                }, {
                  name: `${table}`,
                  source: bloodhound,
                  display: function(item) {
                    return item.label;
                  },
                  limit: 40
                });
                $(node).bind('click', function(e) {
                  $(node).select();
                });
                var cls = node.className;
                if (cls.includes("is-invalid")) {
                  var parent = node.parentElement;
                  var parentCls = parent.className;
                  parent.className = parentCls + " is-invalid";
                }
              }
              $('.typeahead').each(function() { configure_typeahead_form(this, "{{ table_name }}"); });
            </script>
  </body>
</html>
