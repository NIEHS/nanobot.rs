{% extends "page.html" %}
{% block content %}
<h2>{{ table.table }}</h2>

{% for name, value in column|items -%}
<div class="modal fade" id="{{ name|id }}Modal" tabindex="-1" aria-labelledby="{{ name|id }}ModalLabel"
  aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="{{ name|id }}ModalLabel">{{ name }}</h1>
        <button type="button" class="btn" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        {% if value.description %}
        <p>{{ value.description }}</p>
        {% endif %}
        <p>TODO: sort and filter</p>
        {% if value.filters %}
        <ul>
          {% for filter in value.filters %}
          <li>{{ filter[0] }} {{ filter[1] }} {{ filter[2] }}</li>
          {% endfor %}
        </ul>
        {% endif %}
        <pre><code>{{ value|tojson(true) }}</code></pre>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary">Update</button>
      </div>
    </div>
  </div>
</div>
{% endfor %}

<div class="row justify-content-end">
  <div class="col-auto">
    <div class="dropdown">
      <button class="btn btn-outline-primary dropdown-toggle" type="button" data-bs-toggle="dropdown"
        aria-expanded="false">
        Format
      </button>
      <ul class="dropdown-menu">
        {% for name, href in table.formats|items %}
        <li><a class="dropdown-item" href="{{ href }}">{{ name }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div class="col-auto">
    <a class="btn btn-outline-primary" href="{{ table.href }}">Reset</a>
  </div>
  <div class="col-auto">
    <nav aria-label="Page navigation">
      <ul class="pagination">
        <li class="page-item">
          <a class="page-link {{ 'disabled' if not table.first }}" href="{{ table.first }}" aria-label="First">
            <span aria-hidden="true"><i class="bi bi-chevron-bar-left"></i></span>
            <span class="visually-hidden">First</span>
          </a>
        </li>
        <li class="page-item">
          <a class="page-link {{ 'disabled' if not table.previous }}" href="{{ table.previous }}" aria-label="Previous">
            <span aria-hidden="true"><i class="bi bi-chevron-left"></i></span>
            <span class="visually-hidden">Previous</span>
          </a>
        </li>
        <li class="page-item">
          <a class="page-link" href="#">
            {{ table.start }}-{{ table.end }} of {{ table.count }}
          </a>
        </li>
        <li class="page-item">
          <a class="page-link {{ 'disabled' if not table.next }}" href="{{ table.next }}" aria-label="Next">
            <span aria-hidden="true"><i class="bi bi-chevron-right"></i></span>
            <span class="visually-hidden">Next</span>
          </a>
        </li>
        <li class="page-item">
          <a class="page-link {{ 'disabled' if not table.last }}" href="{{ table.last }}" aria-label="Last">
            <span aria-hidden="true"><i class="bi bi-chevron-bar-right"></i></span>
            <span class="visually-hidden">Last</span>
          </a>
        </li>
      </ul>
    </nav>
  </div>
</div>

<table class="table">
  <tr>
    {% for name, value in column|items -%}
    <th>
      <a class="" data-bs-toggle="modal" href="#{{ name|id }}Modal" role="button">{{ name }}</a>
      {% if value.filters %}
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-funnel-fill"
        viewBox="0 0 16 16">
        <path
          d="M1.5 1.5A.5.5 0 0 1 2 1h12a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.128.334L10 8.692V13.5a.5.5 0 0 1-.342.474l-3 1A.5.5 0 0 1 6 14.5V8.692L1.628 3.834A.5.5 0 0 1 1.5 3.5v-2z" />
      </svg>
      {% endif %}
    </th>
    {% endfor %}
  </tr>
  {% for r in row -%}
  <tr>
    {% for column, cell in r|items -%}
    {% if column != "row_number" %}
    <td class="{{ cell.classes|join(" , ") }}">
      {% if cell.nulltype %}
      {% elif cell.href %}
      <a href="{{ cell.href }}">{{ cell.value }}</a>
      {% else %}
      {{ cell.value }}
      {% endif %}
      {% if cell.messages %}
      <div class="dropdown float-end">
        <button type="button" class="badge text-bg-{{ cell.message_level|level_to_bootstrap }} rounded-pill"
          data-bs-toggle="dropdown" aria-expanded="true" data-bs-auto-close="outside">
          {{ cell.messages|length }}
        </button>
        <ul class="dropdown-menu">
          {% for message in cell.messages %}
          <li>
            <a class="dropdown-item" href="#">
              {% if message.level == "error" %}
              <i class="bi bi-exclamation-octagon-fill text-danger"></i>
              {% elif message.level == "warn" %}
              <i class="bi bi-exclamation-triangle-fill text-warning"></i>
              {% elif message.level == "info" %}
              <i class="bi bi-info-circle-fill text-info"></i>
              {% else %}
              <i class="bi bi-question-circle-fill"></i>
              {% endif %}
              {{ message.message }}
            </a>
          </li>
          {% endfor %}
        </ul>
      </div>
    </td>
    {% endif %}
    </td>
    {% endif %}
    {% endfor %}
  </tr>
  {% endfor %}
</table>
{% endblock %}